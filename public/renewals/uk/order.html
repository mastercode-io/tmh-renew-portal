<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Renewal Order - The Trademark Helpline</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Nunito+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./assets/css/order-styles.css">
</head>
<body>
  <a href="#main" class="skip-link">Skip to content</a>

  <header class="site-header">
    <div class="container header-inner">
      <div class="brand">
        <img src="./assets/images/tmh-logo.svg" alt="The Trademark Helpline" class="logo">
      </div>
      <nav class="nav">
        <a href="tel:01618335400" class="contact-link">
          <svg class="nav-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" fill="currentColor"/>
          </svg>
          <span>0161 833 5400</span>
        </a>
        <a href="mailto:enquiries@thetrademarkhelpline.com" class="contact-link">
          <svg class="nav-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
            <polyline points="22,6 12,13 2,6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>enquiries@thetrademarkhelpline.com</span>
        </a>
      </nav>
    </div>
  </header>

  <!-- Error Banner for Missing/Invalid Order Data -->
  <div class="token-error-banner hidden" id="token-error-banner">
    <div class="container">
      <div class="error-banner-card">
        <div class="error-banner-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="48" height="48" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
          </svg>
        </div>
        <div class="error-banner-content">
          <h2 class="error-banner-title">Complete the Renewal Form First</h2>
          <p class="error-banner-message" id="error-banner-message">
            You must complete the renewal form before accessing this page.<br>Please start from the beginning to review your trademark renewal.
          </p>
          <div class="error-banner-actions">
            <a class="btn btn-primary" href="/renewals/uk/">Return to Renewal Form</a>
            <a class="btn btn-outline" href="https://bookings.thetrademarkhelpline.com/#/4584810000004811044" target="_blank" rel="noopener">Book Your Renewal Review</a>
            <a class="btn btn-outline" href="https://www.thetrademarkhelpline.com" target="_blank" rel="noopener">Visit Our Website</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <main id="main">
    <section class="invoice-section">
      <div class="container">
        <div class="invoice-container">
          <!-- Invoice Header -->
          <div class="invoice-header">
            <h1>Renewal Order</h1>
            <p class="muted">Please review your renewal costs below</p>
          </div>

          <!-- Trademark Info Card -->
          <div class="trademark-info-card">
            <h3>Trademark Details</h3>
            <div class="info-grid">
              <div class="info-item">
                <span class="label">Word Mark</span>
                <span class="value" id="word-mark">—</span>
              </div>
              <div class="info-item">
                <span class="label">Application Number</span>
                <span class="value" id="app-number">—</span>
              </div>
              <div class="info-item">
                <span class="label">Mark Type</span>
                <span class="value" id="mark-type">—</span>
              </div>
              <div class="info-item">
                <span class="label">Number of Classes</span>
                <span class="value" id="class-count">—</span>
              </div>
            </div>
          </div>

          <!-- Invoice Table -->
          <div class="invoice-table-wrapper">
            <table class="invoice-table">
              <thead>
                <tr>
                  <th class="item-col">Item</th>
                  <th class="qty-col">Quantity</th>
                  <th class="cost-col">Cost</th>
                </tr>
              </thead>
              <tbody id="invoice-items">
                <!-- Items will be populated by JavaScript -->
              </tbody>
              <tfoot>
                <tr class="subtotal-row">
                  <td colspan="2">Subtotal</td>
                  <td id="subtotal">£0.00</td>
                </tr>
                <tr class="vat-row">
                  <td colspan="2">VAT (20%)</td>
                  <td id="vat">£0.00</td>
                </tr>
                <tr class="total-row">
                  <td colspan="2">Total Payable</td>
                  <td id="total">£0.00</td>
                </tr>
              </tfoot>
            </table>
          </div>

          <!-- Terms and Conditions -->
          <div class="terms-section">
            <label class="terms-checkbox">
              <input type="checkbox" id="terms-checkbox" required>
              <span>I agree to the <a href="./terms.html" target="_blank" rel="noopener">Terms and Conditions</a></span>
            </label>
            <span class="terms-error" id="terms-error" style="display: none;">You must agree to the Terms and Conditions to proceed</span>
          </div>

          <!-- Monitoring Upsell -->
          <div class="monitoring-upsell">
            <h3>Before you pay...</h3>
            <p>Would you like to discuss how monitoring services can save you money on your trademark maintenance and renewals?</p>

            <div class="action-buttons">
              <a href="https://bookings.thetrademarkhelpline.com/#/4584810000004811044" class="btn btn-ghost btn-lg" id="book-call-btn">
                <span>Yes - Book a Call</span>
              </a>
              <a href="#" id="pay-now-btn" class="btn btn-primary btn-lg">
                <span>No - I want to pay now</span>
              </a>
            </div>
          </div>

          <div class="payment-status-panel" id="payment-status-panel" aria-live="polite" hidden>
            <p class="payment-status-title" id="payment-status-title"></p>
            <p class="payment-status-message" id="payment-status-message"></p>
            <div class="payment-status-actions" id="payment-status-actions"></div>
          </div>

          <!-- Security Note -->
          <div class="security-note">
            <p class="muted">
              <strong>Secure Payment:</strong> All payments are processed securely through Stripe.<br>
              You will receive a draft renewal application and invoice copy via email.
            </p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <div class="foot-brand">
        <img src="./assets/images/tmh-logo-dark.svg" alt="The Trademark Helpline" class="logo" />
        <p class="copyright">© 2025, The Trademark Helpline. All Rights Reserved.</p>
      </div>
      <div class="foot-address">
        <svg class="location-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" fill="currentColor"/>
        </svg>
        <div class="address-text">
          <p>Craven Business Centre, 4-5 Craven Court,</p>
          <p>Craven Road, Altrincham, Greater Manchester,</p>
          <p>WA14 5DY, UK</p>
        </div>
      </div>
    </div>
  </footer>

  <script src="./assets/js/order.js"></script>

  <!-- Zoho SalesIQ Widget -->
  <script>window.$zoho=window.$zoho || {};$zoho.salesiq=$zoho.salesiq||{ready:function(){}}</script>
  <script id="zsiqscript" src="https://salesiq.zohopublic.com/widget?wc=siq2ff2511837e9259c4710382e24bf6229d5558ce1d558304328de39ae7c11deaf" defer></script>

  <!-- SalesIQ Visitor Tracking -->
  <script>
    (function() {
      // Helper to safely get sessionStorage
      function getVisitorData(key, defaultValue) {
        try {
          var stored = sessionStorage.getItem('salesiq_visitor_' + key);
          return stored || defaultValue || '';
        } catch (e) {
          return defaultValue || '';
        }
      }

      // Initialize SalesIQ with visitor data from sessionStorage or currentOrderData
      function initializeSalesIQ() {
        var visitorData = {
          email: getVisitorData('email'),
          name: getVisitorData('name'),
          phone: getVisitorData('phone')
        };

        var dealId = '';
        var trademarkNumber = '';
        var trademarkName = '';

        // Try to get data from currentOrderData (populated by order.js)
        if (window.currentOrderData) {
          dealId = window.currentOrderData.deal_id || window.currentOrderData.dealId || '';

          if (window.currentOrderData.trademark) {
            trademarkNumber = window.currentOrderData.trademark.registration_number || '';
            trademarkName = window.currentOrderData.trademark.word_mark || '';
          }
        }

        // Initialize SalesIQ when ready
        (function(oldReady) {
          $zoho.salesiq.ready = function() {
            // Preserve any existing logic
            if (typeof oldReady === 'function') oldReady();

            // Set visitor information
            if (visitorData.name) {
              $zoho.salesiq.visitor.name(visitorData.name);
            }

            if (visitorData.email) {
              $zoho.salesiq.visitor.email(visitorData.email);
            }

            if (visitorData.phone) {
              $zoho.salesiq.visitor.contactnumber(visitorData.phone);
            }

            // Set custom visitor info including deal ID
            var customInfo = {};
            if (dealId) {
              customInfo['Deal ID'] = dealId;
            }
            if (trademarkNumber) {
              customInfo['Trademark Number'] = trademarkNumber;
            }
            if (trademarkName) {
              customInfo['Trademark Name'] = trademarkName;
            }

            if (Object.keys(customInfo).length > 0) {
              $zoho.salesiq.visitor.info(customInfo);
            }

            console.log('[SalesIQ Order Page] Visitor initialized:', visitorData.email || 'anonymous', dealId ? '(Deal: ' + dealId + ')' : '');
          };
        })($zoho.salesiq.ready);
      }

      // Wait for currentOrderData or initialize immediately
      if (window.currentOrderData) {
        initializeSalesIQ();
      } else {
        var checkInterval = setInterval(function() {
          if (window.currentOrderData) {
            clearInterval(checkInterval);
            initializeSalesIQ();
          }
        }, 100);

        // Timeout after 5 seconds and initialize anyway
        setTimeout(function() {
          clearInterval(checkInterval);
          initializeSalesIQ();
        }, 5000);
      }
    })();
  </script>
</body>
</html>
